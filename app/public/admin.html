<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Pemanggilan Antrian</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        .section { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        h3 { margin-bottom: 15px; color: #333; }
        .status { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .status-item { text-align: center; padding: 15px; background: #e9ecef; border-radius: 8px; }
        .status-number { font-size: 24px; font-weight: bold; color: #007bff; }
        .button-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        button { padding: 15px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; color: white; }
        button:hover { opacity: 0.9; }
        .btn-cs { background: #27ae60; }
        .btn-teller { background: #2980b9; }
        .btn-danger { background: #dc3545; }
        .btn-secondary { background: #6c757d; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        .queue-list { background: #f8f9fa; padding: 20px; border-radius: 8px; max-height: 400px; overflow-y: auto; }
        .queue-item { display: flex; justify-content: space-between; padding: 10px; background: white; margin-bottom: 10px; border-radius: 5px; border-left: 4px solid #007bff; }
        .queue-number { font-weight: bold; color: #007bff; font-size: 18px; }
        .links { text-align: center; margin-top: 20px; }
        .links a { margin: 0 10px; color: #007bff; text-decoration: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Admin - Pemanggilan Antrian</h1>
        
        <div class="status">
            <div class="status-item">
                <div class="status-number" id="cs1">000</div>
                <div>CS 1</div>
            </div>
            <div class="status-item">
                <div class="status-number" id="cs2">000</div>
                <div>CS 2</div>
            </div>
            <div class="status-item">
                <div class="status-number" id="t1">000</div>
                <div>Teller 1</div>
            </div>
            <div class="status-item">
                <div class="status-number" id="t2">000</div>
                <div>Teller 2</div>
            </div>
        </div>
        
        <div class="status">
            <div class="status-item" style="grid-column: span 2;">
                <div class="status-number" id="totalCS">0</div>
                <div>Antrian CS</div>
            </div>
            <div class="status-item" style="grid-column: span 2;">
                <div class="status-number" id="totalTeller">0</div>
                <div>Antrian Teller</div>
            </div>
        </div>
        
        <div class="section">
            <h3>Panggil Antrian Berikutnya</h3>
            <div class="button-grid">
                <button class="btn-cs" onclick="nextQueue('cs1')">Panggil ke CS 1</button>
                <button class="btn-cs" onclick="nextQueue('cs2')">Panggil ke CS 2</button>
                <button class="btn-teller" onclick="nextQueue('t1')">Panggil ke Teller 1</button>
                <button class="btn-teller" onclick="nextQueue('t2')">Panggil ke Teller 2</button>
            </div>
        </div>
        
        <div class="section">
            <h3>Panggil Ulang Nomor</h3>
            <div class="form-group">
                <label for="recallNumber">Nomor Antrian:</label>
                <input type="text" id="recallNumber" placeholder="Contoh: A001 atau B001" maxlength="4">
            </div>
            <div class="button-grid">
                <button class="btn-cs" onclick="recallNumber('cs1')">Panggil Ulang ke CS 1</button>
                <button class="btn-cs" onclick="recallNumber('cs2')">Panggil Ulang ke CS 2</button>
                <button class="btn-teller" onclick="recallNumber('t1')">Panggil Ulang ke Teller 1</button>
                <button class="btn-teller" onclick="recallNumber('t2')">Panggil Ulang ke Teller 2</button>
            </div>
        </div>
        
        <div style="text-align: center; margin-bottom: 20px;">
            <button class="btn-danger" onclick="resetQueue()">Reset Semua Antrian</button>
        </div>
        
        <div class="queue-list">
            <h3>Daftar Antrian</h3>
            <div id="queueList">
                <p>Tidak ada antrian</p>
            </div>
        </div>
        
        <div class="links">
            <a href="/ambil-nomor.html" target="_blank">Buka Ambil Nomor</a> |
            <a href="/display" target="_blank">Buka Display</a>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        socket.on('queueUpdated', (data) => {
            updateDisplay(data);
        });
        
        function updateDisplay(data) {
            document.getElementById('totalCS').textContent = data.totalCS || 0;
            document.getElementById('totalTeller').textContent = data.totalTeller || 0;
            document.getElementById('cs1').textContent = data.counters.cs1.current;
            document.getElementById('cs2').textContent = data.counters.cs2.current;
            document.getElementById('t1').textContent = data.counters.t1.current;
            document.getElementById('t2').textContent = data.counters.t2.current;
            
            const queueList = document.getElementById('queueList');
            const allQueue = [...(data.queueCS || []), ...(data.queueTeller || [])];
            
            if (allQueue.length === 0) {
                queueList.innerHTML = '<p>Tidak ada antrian</p>';
            } else {
                queueList.innerHTML = allQueue.map(item => `
                    <div class="queue-item">
                        <div>
                            <span class="queue-number">${item.number}</span>
                            <span> - ${item.name}</span>
                        </div>
                        <small>${new Date(item.timestamp).toLocaleTimeString()}</small>
                    </div>
                `).join('');
            }
        }
        
        async function nextQueue(counter) {
            try {
                const response = await fetch('/api/next-queue', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ counter })
                });
                const result = await response.json();
                
                if (!result.success) {
                    alert(result.message);
                }
            } catch (error) {
                alert('Gagal memanggil antrian');
            }
        }
        
        async function recallNumber(counter) {
            const number = document.getElementById('recallNumber').value.trim().toUpperCase();
            
            if (!number) {
                alert('Masukkan nomor antrian');
                return;
            }
            
            try {
                const response = await fetch('/api/recall-number', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ number: number, counter: counter })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('recallNumber').value = '';
                } else {
                    alert(result.message || 'Gagal memanggil ulang nomor');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function resetQueue() {
            if (confirm('Yakin ingin reset semua antrian?')) {
                try {
                    const response = await fetch('/api/reset-queue', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('Antrian berhasil direset');
                    } else {
                        alert('Gagal reset antrian');
                    }
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            }
        }
    </script>
</body>
</html>
